"use strict";(self.webpackChunkng_weather=self.webpackChunkng_weather||[]).push([[77],{8077:(tt,b,s)=>{s.r(b),s.d(b,{WeatherModule:()=>V});var p=s(3878),t=s(9227),M=s(5125),v=s(8152),x=s(5869);const C="locations";let g=(()=>{var n;class r{constructor(e){this.notificationService=e,this.locations=new M.X([]),this.locationHasBeenRemoved=new v.xQ,this.locationHasBeenAdded=new v.xQ,this.locations$=this.locations.asObservable(),this.locationHasBeenRemoved$=this.locationHasBeenRemoved.asObservable(),this.locationHasBeenAdded$=this.locationHasBeenAdded.asObservable();let i=JSON.parse(localStorage.getItem(C));i&&this.locations.next(i)}addLocation(e){const i=this.locations.getValue();if(i.includes(e))this.notificationService.show("You have already that zipcode inserted, please, try other one!","error");else{let a=[...i,e];localStorage.setItem(C,JSON.stringify(a)),this.locations.next(a),this.locationHasBeenAdded.next(e)}}removeLocation(e,i=!1){const c=this.locations.getValue().filter(h=>h!==e);localStorage.setItem(C,JSON.stringify(c)),this.locations.next(c),i||this.locationHasBeenRemoved.next(e)}}return(n=r).\u0275fac=function(e){return new(e||n)(t.LFG(x.g))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),r})(),A=(()=>{var n;class r{constructor(e){this.locationService=e}addLocation(e){this.locationService.addLocation(e)}}return(n=r).\u0275fac=function(e){return new(e||n)(t.Y36(g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-zipcode-entry"]],decls:8,vars:0,consts:[[1,"well"],["type","text","placeholder","Zipcode",1,"form-control"],["zipcode",""],[1,"btn","btn-primary",3,"click"]],template:function(e,i){if(1&e){const a=t.EpF();t.TgZ(0,"div",0)(1,"h2"),t._uU(2,"Enter a zipcode:"),t.qZA(),t._UZ(3,"input",1,2)(5,"br"),t.TgZ(6,"button",3),t.NdJ("click",function(){t.CHM(a);const h=t.MAs(4);return t.KtG(i.addLocation(h.value))}),t._uU(7," Add location "),t.qZA()()}},styles:[".well[_ngcontent-%COMP%]{background-color:var(--color-dark);border:none;border-radius:5px}input[_ngcontent-%COMP%]{background-color:var(--color-darkest);border:none;color:#fff;max-width:300px}button[_ngcontent-%COMP%]{background-color:var(--main-color)}"]}),r})();var L=s(4699),O=s(1257),Z=s(1280);function y(n){return!(0,Z.k)(n)&&n-parseFloat(n)+1>=0}var _=s(9759);function w(n){const{index:r,period:o,subscriber:e}=n;if(e.next(r),!e.closed){if(-1===o)return e.complete();n.index=r+1,this.schedule(n,o)}}var N=s(9193),f=s(553),D=function(){function n(){this._subs=[]}return n.prototype.add=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this._subs=this._subs.concat(r)},Object.defineProperty(n.prototype,"sink",{set:function(r){this._subs.push(r)},enumerable:!0,configurable:!0}),n.prototype.unsubscribe=function(){this._subs.forEach(function(r){return r&&function(n){return"function"==typeof n}(r.unsubscribe)&&r.unsubscribe()}),this._subs=[]},n}(),T=s(1418),$=s(7927),J=s(9862);let F=(()=>{var n;class r{constructor(){this.defaultExpiryInSeconds=f.N.defaultExpiryInSeconds}setItem(e,i){const a={value:i,creation:Date.now()};localStorage.setItem(e,JSON.stringify(a))}getItem(e){const i=localStorage.getItem(e);if(!i)return null;const a=JSON.parse(i);return(new Date).getTime()>a.creation+1e3*this.defaultExpiryInSeconds?(localStorage.removeItem(e),null):a.value}removeItem(e){localStorage.removeItem(e)}}return(n=r).\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),r})();var d;class u{constructor(r,o,e,i){this.http=r,this.locationService=o,this.cacheService=e,this.notificationService=i,this.currentConditions=(0,t.tdS)([]),this.subs=new D,this.discriminationKeys={forConditions:"current-condition-",forForecasts:"forecast-"},o.locations$.pipe((0,T.q)(1)).subscribe(a=>{for(let c of a)this.addCurrentConditions(c)}),this.subs.add(o.locationHasBeenRemoved$.subscribe(this.removeCurrentConditions.bind(this))),this.subs.add(o.locationHasBeenAdded$.subscribe(this.addCurrentConditions.bind(this))),this.subs.add(function P(n=0,r,o){let e=-1;return y(r)?e=Number(r)<1?1:Number(r):(0,_.K)(r)&&(o=r),(0,_.K)(o)||(o=O.P),new L.y(i=>{const a=y(n)?n:+n-o.now();return o.schedule(w,a,{index:0,period:e,subscriber:i})})}(2e3,f.N.cacheCheckAndApiUpdateInterval).subscribe(()=>{o.locations$.pipe((0,T.q)(1)).subscribe(a=>{for(let c of a)this.updateCurrentCondition(c)})}))}updateCurrentCondition(r){null===this.cacheService.getItem(`${this.discriminationKeys.forConditions}${r}`)&&this.getCurrentConditionFromAPI(r).subscribe(o=>{this.currentConditions.mutate(e=>{let i=e.findIndex(a=>a.zip===r);return console.log(o),this.notificationService.show("Data synchronized from server"),e[i].data=o}),this.cacheService.setItem(`${this.discriminationKeys.forConditions}${r}`,o)},o=>{this.notificationService.show("The zipcode provided doesn't existe in our database, please, Try another! Thanks","error"),this.locationService.removeLocation(r,!0)})}ngOnDestroy(){this.subs.unsubscribe()}getCurrentConditionFromAPI(r){return this.http.get(`${u.URL}/weather?zip=${r},us&units=imperial&APPID=${u.APPID}`)}addCurrentConditions(r){const o=this.cacheService.getItem(`${this.discriminationKeys.forConditions}${r}`);null!==o?this.currentConditions.mutate(e=>e.push({zip:r,data:o})):this.getCurrentConditionFromAPI(r).subscribe(e=>{this.currentConditions.mutate(i=>i.push({zip:r,data:e})),this.cacheService.setItem(`${this.discriminationKeys.forConditions}${r}`,e)},e=>{this.notificationService.show("The zipcode provided doesn't existe in our database, please, Try another! Thanks","error"),this.locationService.removeLocation(r,!0)})}removeCurrentConditions(r){this.cacheService.removeItem(`${this.discriminationKeys.forConditions}${r}`),this.currentConditions.mutate(o=>{for(let e in o)o[e].zip==r&&o.splice(+e,1)})}getCurrentConditions(){return this.currentConditions.asReadonly()}getForecast(r){const o=this.cacheService.getItem(`${this.discriminationKeys.forForecasts}${r}`);return null!==o?(0,N.of)(o):this.http.get(`${u.URL}/forecast/daily?zip=${r},us&units=imperial&cnt=5&APPID=${u.APPID}`).pipe((0,$.b)(e=>{this.cacheService.setItem(`${this.discriminationKeys.forForecasts}${r}`,e)}))}}(d=u).URL=f.N.weatherAPI_URL,d.APPID=f.N.appID,d.\u0275fac=function(r){return new(r||d)(t.LFG(J.eN),t.LFG(g),t.LFG(F),t.LFG(x.g))},d.\u0275prov=t.Yz7({token:d,factory:d.\u0275fac});var l=s(6814);const U=function(n){return{selected:n}};function B(n,r){if(1&n){const o=t.EpF();t.TgZ(0,"li",3)(1,"span",4),t.NdJ("click",function(){const a=t.CHM(o).index,c=t.oxw();return t.KtG(c.currentSelected=a)}),t._uU(2),t.qZA(),t.TgZ(3,"span",5),t.NdJ("click",function(){const i=t.CHM(o),a=i.$implicit,c=i.index,h=t.oxw();return t.KtG(h.deleteTab(a.tabId,c))}),t._uU(4,"X"),t.qZA()()}if(2&n){const o=r.$implicit,e=r.index,i=t.oxw();t.Q6J("ngClass",t.VKq(2,U,e===i.currentSelected)),t.xp6(2),t.Oqu(o.label)}}function E(n,r){if(1&n&&(t.ynx(0),t.GkF(1,7),t.BQk()),2&n){const o=t.oxw().$implicit;t.xp6(1),t.Q6J("ngTemplateOutlet",o.template)("ngTemplateOutletContext",o.context)}}function H(n,r){if(1&n&&(t.ynx(0),t.YNc(1,E,2,2,"ng-container",6),t.BQk()),2&n){const o=r.index,e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.currentSelected===o)}}let S=(()=>{var n;class r{constructor(){this.tabsData=[],this.tabDeleted=new t.vpe,this.currentSelected=0}deleteTab(e,i){this.currentSelected===i&&(this.currentSelected=0),this.tabDeleted.emit(e)}trackByFn(e,i){return i.tabId}}return(n=r).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-tabs-navigator"]],inputs:{tabsData:"tabsData"},outputs:{tabDeleted:"tabDeleted"},standalone:!0,features:[t.jDz],decls:4,vars:2,consts:[[3,"ngClass",4,"ngFor","ngForOf"],[1,"tab-content"],[4,"ngFor","ngForOf"],[3,"ngClass"],[1,"tab-label",3,"click"],[1,"tab-close",3,"click"],[4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,i){1&e&&(t.TgZ(0,"ul"),t.YNc(1,B,5,4,"li",0),t.qZA(),t.TgZ(2,"div",1),t.YNc(3,H,2,1,"ng-container",2),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",i.tabsData),t.xp6(2),t.Q6J("ngForOf",i.tabsData))},dependencies:[l.ez,l.mk,l.sg,l.O5,l.tP,p.Bz],styles:["[_nghost-%COMP%]{display:block}ul[_ngcontent-%COMP%]{list-style:none;display:flex;gap:.5rem;margin-bottom:0}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{background-color:var(--main-color);padding-right:.5rem;border-top-right-radius:5px;border-top-left-radius:5px;color:#fff;cursor:pointer;display:flex;align-items:center}ul[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{background-color:var(--main-color-ligth)}.tab-label[_ngcontent-%COMP%]{display:inline-block;padding:.5rem 1rem;color:#fff}.tab-close[_ngcontent-%COMP%]{display:inline-block;width:20px;height:20px;background-color:red;border-radius:5px;text-align:center}div[_ngcontent-%COMP%]{padding:1rem;border:1px solid black}.tab-content[_ngcontent-%COMP%]{width:100%;background-color:var(--main-color-ligth)}"],changeDetection:0}),r})();const m=f.N.iconURL;let I=(()=>{var n;class r{transform(e){return e>=200&&e<=232?m+"art_storm.png":e>=501&&e<=511?m+"art_rain.png":500===e||e>=520&&e<=531?m+"art_light_rain.png":e>=600&&e<=622?m+"art_snow.png":e>=801&&e<=804?m+"art_clouds.png":741===e||761===e?m+"art_fog.png":m+"art_clear.png"}}return(n=r).\u0275fac=function(e){return new(e||n)},n.\u0275pipe=t.Yjl({name:"appIconNameFromWeather",type:n,pure:!0,standalone:!0}),r})();const z=["cardTemplate"];function Q(n,r){if(1&n){const o=t.EpF();t.TgZ(0,"div")(1,"app-tabs-navigator",3),t.NdJ("tabDeleted",function(i){t.CHM(o);const a=t.oxw();return t.KtG(a.conditionDeleted(i))}),t.qZA()()}if(2&n){const o=t.oxw();t.xp6(1),t.Q6J("tabsData",o.tabsDataFromCurrentConditions)}}function K(n,r){1&n&&t._uU(0," There aren't any zip codes inserted. Could you please add a new zip code? \u{1f60a}\n")}const R=function(n){return["/weather-app","forecast",n]};function Y(n,r){if(1&n&&(t.TgZ(0,"div",4)(1,"div")(2,"h3"),t._uU(3),t.qZA(),t.TgZ(4,"h4"),t._uU(5),t.qZA(),t.TgZ(6,"h4"),t._uU(7,"Temperatures today:"),t.qZA(),t.TgZ(8,"p"),t._uU(9),t.ALo(10,"number"),t.ALo(11,"number"),t.ALo(12,"number"),t.qZA(),t.TgZ(13,"p")(14,"a",5),t._uU(15),t.qZA()()(),t.TgZ(16,"div"),t._UZ(17,"img",6),t.ALo(18,"appIconNameFromWeather"),t.qZA()()),2&n){const o=r.location;t.xp6(3),t.AsE("",o.data.name," (",o.zip,")"),t.xp6(2),t.hij("Current conditions: ",o.data.weather[0].main,""),t.xp6(4),t.lnq(" Current ",t.xi3(10,9,o.data.main.temp,".0-0")," - Max ",t.xi3(11,12,o.data.main.temp_max,".0-0")," - Min ",t.xi3(12,15,o.data.main.temp_min,".0-0")," "),t.xp6(5),t.Q6J("routerLink",t.VKq(20,R,o.zip)),t.xp6(1),t.hij("Show 5-day forecast for ",o.data.name,""),t.xp6(2),t.Q6J("src",t.lcZ(18,18,o.data.weather[0].id),t.LSH)}}let W=(()=>{var n;class r{constructor(e){this.cdr=e,this.weatherService=(0,t.f3M)(u),this.router=(0,t.f3M)(p.F0),this.locationService=(0,t.f3M)(g),this.currentConditionsByZip=this.weatherService.getCurrentConditions()}ngAfterViewInit(){this.cdr.detectChanges()}get tabsDataFromCurrentConditions(){return this.currentConditionsByZip().map(e=>({label:`${e.data.name} (${e.zip})`,tabId:e.zip,template:this.cardTemplate,context:{location:e}}))}showForecast(e){this.router.navigate(["/forecast",e])}conditionDeleted(e){this.locationService.removeLocation(e)}}return(n=r).\u0275fac=function(e){return new(e||n)(t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-current-conditions"]],viewQuery:function(e,i){if(1&e&&t.Gf(z,5),2&e){let a;t.iGM(a=t.CRH())&&(i.cardTemplate=a.first)}},decls:5,vars:2,consts:[[4,"ngIf","ngIfElse"],["noTabsMessage",""],["cardTemplate",""],[3,"tabsData","tabDeleted"],[1,"card"],[3,"routerLink"],[3,"src"]],template:function(e,i){if(1&e&&(t.YNc(0,Q,2,1,"div",0),t.YNc(1,K,1,0,"ng-template",null,1,t.W1O),t.YNc(3,Y,19,22,"ng-template",null,2,t.W1O)),2&e){const a=t.MAs(2);t.Q6J("ngIf",i.tabsDataFromCurrentConditions.length>0)("ngIfElse",a)}},dependencies:[l.O5,p.rH,S,l.JJ,I],styles:[".card[_ngcontent-%COMP%]{display:flex;background-color:var(--color-dark);padding:1rem;border-radius:10px;box-shadow:#00000080 1.95px 1.95px 2.6px}"],changeDetection:0}),r})();function j(n,r){if(1&n&&(t.TgZ(0,"li",6),t._uU(1),t.ALo(2,"date"),t.ALo(3,"number"),t.ALo(4,"number"),t._UZ(5,"img",7),t.ALo(6,"appIconNameFromWeather"),t.qZA()),2&n){const o=r.$implicit;t.xp6(1),t.HOy(" ",t.xi3(2,5,1e3*o.dt,"EEEE, MMM d"),": ",o.weather[0].main," - Min: ",t.xi3(3,8,o.temp.min,".0-0")," - Max: ",t.xi3(4,11,o.temp.max,".0-0")," "),t.xp6(4),t.Q6J("src",t.lcZ(6,14,o.weather[0].id),t.LSH)}}const q=[{path:"",component:(()=>{var n;class r{}return(n=r).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-main-page"]],decls:3,vars:0,consts:[[1,"container-fluid"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-zipcode-entry")(2,"app-current-conditions"),t.qZA())},dependencies:[A,W],styles:["[_nghost-%COMP%]{display:block}"]}),r})()},{path:"forecast/:zipcode",component:(()=>{var n;class r{constructor(e,i){this.weatherService=e,i.params.subscribe(a=>{this.zipcode=a.zipcode,e.getForecast(this.zipcode).subscribe(c=>this.forecast=c)})}}return(n=r).\u0275fac=function(e){return new(e||n)(t.Y36(u),t.Y36(p.gz))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-forecasts-list"]],decls:9,vars:3,consts:[[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-title"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"btn","btn-success",3,"routerLink"],[1,"list-group-item"],[1,"icon",3,"src"]],template:function(e,i){1&e&&(t.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"h3",2),t._uU(4),t.qZA()(),t.TgZ(5,"ul",3),t.YNc(6,j,7,16,"li",4),t.qZA()()(),t.TgZ(7,"button",5),t._uU(8,"< Back to main page"),t.qZA()),2&e&&(t.xp6(4),t.hij("5-day forecast for ",null==i.forecast?null:i.forecast.city.name,""),t.xp6(2),t.Q6J("ngForOf",null==i.forecast?null:i.forecast.list),t.xp6(1),t.Q6J("routerLink","/"))},dependencies:[l.sg,p.rH,l.JJ,l.uU,I],styles:[".icon[_ngcontent-%COMP%]{width:45px;height:45px;position:absolute;right:20px;top:-2px}.panel[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{border:none;margin:0 2rem}button[_ngcontent-%COMP%]{margin-top:1rem}.panel-heading[_ngcontent-%COMP%]{font-variant:small-caps;color:var(--main-color-ligth);background-color:var(--color-dark)!important;border-bottom:2px solid black}.list-group-item[_ngcontent-%COMP%]{background-color:var(--color-dark)}"]}),r})()},{path:"**",redirectTo:"/current-conditions"}];let X=(()=>{var n;class r{}return(n=r).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(q),p.Bz]}),r})(),V=(()=>{var n;class r{}return(n=r).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[g,u,F],imports:[l.ez,X,S]}),r})()}}]);