"use strict";(self.webpackChunkng_weather=self.webpackChunkng_weather||[]).push([[836],{6836:(X,C,c)=>{c.r(C),c.d(C,{WeatherModule:()=>q});var m=c(3878),t=c(9227),M=c(5125),b=c(8152),v=c(5869);const g="locations";let h=(()=>{var n;class o{constructor(e){this.notificationService=e,this.locations=new M.X([]),this.locationHasBeenRemoved=new b.xQ,this.locationHasBeenAdded=new b.xQ,this.locations$=this.locations.asObservable(),this.locationHasBeenRemoved$=this.locationHasBeenRemoved.asObservable(),this.locationHasBeenAdded$=this.locationHasBeenAdded.asObservable();let r=JSON.parse(localStorage.getItem(g));r&&this.locations.next(r)}addLocation(e){const r=this.locations.getValue();if(r.includes(e))this.notificationService.show("You have already that zipcode inserted, please, try other one!","error");else{let s=[...r,e];localStorage.setItem(g,JSON.stringify(s)),this.locations.next(s),this.locationHasBeenAdded.next(e)}}removeLocation(e,r=!1){const l=this.locations.getValue().filter(d=>d!==e);localStorage.setItem(g,JSON.stringify(l)),this.locations.next(l),r||this.locationHasBeenRemoved.next(e)}}return(n=o).\u0275fac=function(e){return new(e||n)(t.LFG(v.g))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),o})(),Z=(()=>{var n;class o{constructor(e){this.locationService=e}addLocation(e){this.locationService.addLocation(e)}}return(n=o).\u0275fac=function(e){return new(e||n)(t.Y36(h))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-zipcode-entry"]],decls:8,vars:0,consts:[[1,"well"],["type","text","placeholder","Zipcode",1,"form-control"],["zipcode",""],[1,"btn","btn-primary",3,"click"]],template:function(e,r){if(1&e){const s=t.EpF();t.TgZ(0,"div",0)(1,"h2"),t._uU(2,"Enter a zipcode:"),t.qZA(),t._UZ(3,"input",1,2)(5,"br"),t.TgZ(6,"button",3),t.NdJ("click",function(){t.CHM(s);const d=t.MAs(4);return t.KtG(r.addLocation(d.value))}),t._uU(7," Add location "),t.qZA()()}},styles:[".well[_ngcontent-%COMP%]{background-color:var(--color-dark);border:none;border-radius:5px}input[_ngcontent-%COMP%]{background-color:var(--color-darkest);border:none;color:#fff;max-width:300px}button[_ngcontent-%COMP%]{background-color:var(--main-color)}"]}),o})();var I=c(4699),F=c(1257),O=c(1280);function y(n){return!(0,O.k)(n)&&n-parseFloat(n)+1>=0}var _=c(9759);function P(n){const{index:o,period:i,subscriber:e}=n;if(e.next(o),!e.closed){if(-1===i)return e.complete();n.index=o+1,this.schedule(n,i)}}var w=c(9193),f=c(553),k=function(){function n(){this._subs=[]}return n.prototype.add=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];this._subs=this._subs.concat(o)},Object.defineProperty(n.prototype,"sink",{set:function(o){this._subs.push(o)},enumerable:!0,configurable:!0}),n.prototype.unsubscribe=function(){this._subs.forEach(function(o){return o&&function(n){return"function"==typeof n}(o.unsubscribe)&&o.unsubscribe()}),this._subs=[]},n}(),x=c(1418),$=c(7927),U=c(9862);let L=(()=>{var n;class o{constructor(){this.defaultExpiryInSeconds=f.N.defaultExpiryInSeconds}setItem(e,r){const s={value:r,creation:Date.now()};localStorage.setItem(e,JSON.stringify(s))}getItem(e){const r=localStorage.getItem(e);if(!r)return null;const s=JSON.parse(r);return(new Date).getTime()>s.creation+1e3*this.defaultExpiryInSeconds?(localStorage.removeItem(e),null):s.value}removeItem(e){localStorage.removeItem(e)}}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),o})();var p;class a{constructor(o,i,e,r){this.http=o,this.locationService=i,this.cacheService=e,this.notificationService=r,this.currentConditions=(0,t.tdS)([]),this.subs=new k,this.discriminationKeys={forConditions:"current-condition-",forForecasts:"forecast-"},i.locations$.pipe((0,x.q)(1)).subscribe(s=>{for(let l of s)this.addCurrentConditions(l)}),this.subs.add(i.locationHasBeenRemoved$.subscribe(this.removeCurrentConditions.bind(this))),this.subs.add(i.locationHasBeenAdded$.subscribe(this.addCurrentConditions.bind(this))),this.subs.add(function A(n=0,o,i){let e=-1;return y(o)?e=Number(o)<1?1:Number(o):(0,_.K)(o)&&(i=o),(0,_.K)(i)||(i=F.P),new I.y(r=>{const s=y(n)?n:+n-i.now();return i.schedule(P,s,{index:0,period:e,subscriber:r})})}(2e3,f.N.cacheCheckAndApiUpdateInterval).subscribe(()=>{i.locations$.pipe((0,x.q)(1)).subscribe(s=>{for(let l of s)this.updateCurrentCondition(l)})}))}updateCurrentCondition(o){null===this.cacheService.getItem(`${this.discriminationKeys.forConditions}${o}`)&&this.getCurrentConditionFromAPI(o).subscribe(i=>{this.currentConditions.mutate(e=>{let r=e.findIndex(s=>s.zip===o);return console.log(i),this.notificationService.show("Data synchronized from server"),e[r].data=i}),this.cacheService.setItem(`${this.discriminationKeys.forConditions}${o}`,i)},i=>{this.notificationService.show("The zipcode provided doesn't existe in our database, please, Try another! Thanks","error"),this.locationService.removeLocation(o,!0)})}ngOnDestroy(){this.subs.unsubscribe()}getCurrentConditionFromAPI(o){return this.http.get(`${a.URL}/weather?zip=${o},us&units=imperial&APPID=${a.APPID}`)}addCurrentConditions(o){const i=this.cacheService.getItem(`${this.discriminationKeys.forConditions}${o}`);null!==i?this.currentConditions.mutate(e=>e.push({zip:o,data:i})):this.http.get(`${a.URL}/weather?zip=${o},us&units=imperial&APPID=${a.APPID}`).subscribe(e=>{this.currentConditions.mutate(r=>r.push({zip:o,data:e})),this.cacheService.setItem(`${this.discriminationKeys.forConditions}${o}`,e)},e=>{this.notificationService.show("The zipcode provided doesn't existe in our database, please, Try another! Thanks","error"),this.locationService.removeLocation(o,!0)})}removeCurrentConditions(o){this.cacheService.removeItem(`${this.discriminationKeys.forConditions}${o}`),this.currentConditions.mutate(i=>{for(let e in i)i[e].zip==o&&i.splice(+e,1)})}getCurrentConditions(){return this.currentConditions.asReadonly()}getForecast(o){const i=this.cacheService.getItem(`${this.discriminationKeys.forForecasts}${o}`);return null!==i?(0,w.of)(i):this.http.get(`${a.URL}/forecast/daily?zip=${o},us&units=imperial&cnt=5&APPID=${a.APPID}`).pipe((0,$.b)(e=>{this.cacheService.setItem(`${this.discriminationKeys.forForecasts}${o}`,e)}))}getWeatherIcon(o){return o>=200&&o<=232?a.ICON_URL+"art_storm.png":o>=501&&o<=511?a.ICON_URL+"art_rain.png":500===o||o>=520&&o<=531?a.ICON_URL+"art_light_rain.png":o>=600&&o<=622?a.ICON_URL+"art_snow.png":o>=801&&o<=804?a.ICON_URL+"art_clouds.png":741===o||761===o?a.ICON_URL+"art_fog.png":a.ICON_URL+"art_clear.png"}}(p=a).URL=f.N.weatherAPI_URL,p.APPID=f.N.appID,p.ICON_URL=f.N.iconURL,p.\u0275fac=function(o){return new(o||p)(t.LFG(U.eN),t.LFG(h),t.LFG(L),t.LFG(v.g))},p.\u0275prov=t.Yz7({token:p,factory:p.\u0275fac});var u=c(6814);const D=function(n){return{selected:n}};function E(n,o){if(1&n){const i=t.EpF();t.TgZ(0,"li",1)(1,"span",2),t.NdJ("click",function(){const r=t.CHM(i),s=r.$implicit,l=r.index,d=t.oxw();return t.KtG(d.tabSelected(s.link,l))}),t._uU(2),t.qZA(),t.TgZ(3,"span",3),t.NdJ("click",function(){const r=t.CHM(i),s=r.$implicit,l=r.index,d=t.oxw();return t.KtG(d.deleteTab(s.link,l))}),t._uU(4,"X"),t.qZA()()}if(2&n){const i=o.$implicit,e=o.index,r=t.oxw();t.Q6J("ngClass",t.VKq(2,D,e===r.currentSelected)),t.xp6(2),t.Oqu(i.label)}}const J=["*"];let S=(()=>{var n;class o{constructor(){this.tabsNames=[],this.tabChosen=new t.vpe,this.tabDeleted=new t.vpe,this.currentSelected=0}tabSelected(e,r){this.currentSelected=r,this.tabChosen.emit(e)}deleteTab(e,r){this.currentSelected===r&&(this.currentSelected=0),this.tabDeleted.emit(e)}}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-tabs-navigator"]],inputs:{tabsNames:"tabsNames"},outputs:{tabChosen:"tabChosen",tabDeleted:"tabDeleted"},standalone:!0,features:[t.jDz],ngContentSelectors:J,decls:4,vars:1,consts:[[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"tab-content",3,"click"],[1,"tab-close",3,"click"]],template:function(e,r){1&e&&(t.F$t(),t.TgZ(0,"ul"),t.YNc(1,E,5,4,"li",0),t.qZA(),t.TgZ(2,"div"),t.Hsn(3),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",r.tabsNames))},dependencies:[u.ez,u.mk,u.sg,m.Bz],styles:["[_nghost-%COMP%]{display:block}ul[_ngcontent-%COMP%]{list-style:none;display:flex;gap:.5rem;margin-bottom:0}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{background-color:var(--main-color);padding-right:.5rem;border-top-right-radius:5px;border-top-left-radius:5px;color:#fff;cursor:pointer}ul[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{background-color:var(--main-color-ligth)}.tab-content[_ngcontent-%COMP%]{display:inline-block;padding:.5rem 1rem;color:#fff}.tab-close[_ngcontent-%COMP%]{display:inline-block;width:20px;height:20px;background-color:red;border-radius:5px;text-align:center}div[_ngcontent-%COMP%]{padding:1rem;border:1px solid black}"],changeDetection:0}),o})();const z=function(n){return["/weather-app","forecast",n]};let T=(()=>{var n;class o{constructor(){this.locationService=(0,t.f3M)(h),this.weatherService=(0,t.f3M)(a)}}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-current-condition-card"]],inputs:{location:"location"},standalone:!0,features:[t.jDz],decls:17,vars:20,consts:[[3,"routerLink"],[3,"src"]],template:function(e,r){1&e&&(t.TgZ(0,"div")(1,"h3"),t._uU(2),t.qZA(),t.TgZ(3,"h4"),t._uU(4),t.qZA(),t.TgZ(5,"h4"),t._uU(6,"Temperatures today:"),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.ALo(9,"number"),t.ALo(10,"number"),t.ALo(11,"number"),t.qZA(),t.TgZ(12,"p")(13,"a",0),t._uU(14),t.qZA()()(),t.TgZ(15,"div"),t._UZ(16,"img",1),t.qZA()),2&e&&(t.xp6(2),t.AsE("",r.location.data.name," (",r.location.zip,")"),t.xp6(2),t.hij("Current conditions: ",r.location.data.weather[0].main,""),t.xp6(4),t.lnq(" Current ",t.xi3(9,9,r.location.data.main.temp,".0-0")," - Max ",t.xi3(10,12,r.location.data.main.temp_max,".0-0")," - Min ",t.xi3(11,15,r.location.data.main.temp_min,".0-0")," "),t.xp6(5),t.Q6J("routerLink",t.VKq(18,z,r.location.zip)),t.xp6(1),t.hij("Show 5-day forecast for ",r.location.data.name,""),t.xp6(2),t.Q6J("src",r.weatherService.getWeatherIcon(r.location.data.weather[0].id),t.LSH))},dependencies:[u.ez,u.JJ,m.Bz,m.rH],styles:["[_nghost-%COMP%]{display:flex;background-color:var(--color-dark);padding:1rem;border-radius:10px;box-shadow:#00000080 1.95px 1.95px 2.6px}h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{color:#fff}.close[_ngcontent-%COMP%]{cursor:pointer}.flex[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"],changeDetection:0}),o})();function B(n,o){if(1&n&&t._UZ(0,"app-current-condition-card",4),2&n){const i=t.oxw(2);t.Q6J("location",i.currentLocationSelected)}}function R(n,o){if(1&n){const i=t.EpF();t.TgZ(0,"app-tabs-navigator",2),t.NdJ("tabChosen",function(r){t.CHM(i);const s=t.oxw();return t.KtG(s.processTabSelection(r))})("tabDeleted",function(r){t.CHM(i);const s=t.oxw();return t.KtG(s.processTabDeletion(r))}),t.YNc(1,B,1,1,"app-current-condition-card",3),t.qZA()}if(2&n){const i=t.oxw();t.Q6J("tabsNames",i.tabsLinksFromCurrentConditions),t.xp6(1),t.Q6J("ngIf",i.currentLocationSelected)}}function H(n,o){1&n&&t._uU(0," There aren't any zip codes inserted. Could you please add a new zip code? \u{1f60a}\n")}let K=(()=>{var n;class o{ngOnInit(){}constructor(){this.weatherService=(0,t.f3M)(a),this.router=(0,t.f3M)(m.F0),this.locationService=(0,t.f3M)(h),this.currentConditionsByZip=this.weatherService.getCurrentConditions(),this.previouslyEmpty=!0,(0,t.cEC)(()=>{this.currentConditionsByZip().length>0?this.previouslyEmpty&&(this.currentLocationSelected=this.currentConditionsByZip()[0],this.previouslyEmpty=!this.previouslyEmpty):this.currentLocationSelected=void 0})}showForecast(e){this.router.navigate(["/forecast",e])}get tabsLinksFromCurrentConditions(){return this.currentConditionsByZip().map(e=>({label:`${e.data.name} (${e.zip})`,link:e.zip}))}processTabSelection(e){this.currentLocationSelected=(0,t.Flj)(()=>this.currentConditionsByZip().find(r=>r.zip===e))()}processTabDeletion(e){this.locationService.removeLocation(e),this.currentLocationSelected.zip===e&&(this.currentLocationSelected=this.currentConditionsByZip()[0],this.previouslyEmpty=!0)}}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-current-conditions"]],decls:4,vars:2,consts:[[3,"tabsNames","tabChosen","tabDeleted",4,"ngIf","ngIfElse"],["noTabsMessage",""],[3,"tabsNames","tabChosen","tabDeleted"],[3,"location",4,"ngIf"],[3,"location"]],template:function(e,r){if(1&e&&(t.TgZ(0,"div"),t.YNc(1,R,2,2,"app-tabs-navigator",0),t.qZA(),t.YNc(2,H,1,0,"ng-template",null,1,t.W1O)),2&e){const s=t.MAs(3);t.xp6(1),t.Q6J("ngIf",r.tabsLinksFromCurrentConditions.length>0)("ngIfElse",s)}},dependencies:[u.O5,S,T],changeDetection:0}),o})();function j(n,o){if(1&n&&(t.TgZ(0,"li",6),t._uU(1),t.ALo(2,"date"),t.ALo(3,"number"),t.ALo(4,"number"),t._UZ(5,"img",7),t.qZA()),2&n){const i=o.$implicit,e=t.oxw();t.xp6(1),t.HOy(" ",t.xi3(2,5,1e3*i.dt,"EEEE, MMM d"),": ",i.weather[0].main," - Min: ",t.xi3(3,8,i.temp.min,".0-0")," - Max: ",t.xi3(4,11,i.temp.max,".0-0")," "),t.xp6(4),t.Q6J("src",e.weatherService.getWeatherIcon(i.weather[0].id),t.LSH)}}const Y=[{path:"",component:(()=>{var n;class o{}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-main-page"]],decls:3,vars:0,consts:[[1,"container-fluid"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-zipcode-entry")(2,"app-current-conditions"),t.qZA())},dependencies:[Z,K],styles:["[_nghost-%COMP%]{display:block}"]}),o})()},{path:"forecast/:zipcode",component:(()=>{var n;class o{constructor(e,r){this.weatherService=e,r.params.subscribe(s=>{this.zipcode=s.zipcode,e.getForecast(this.zipcode).subscribe(l=>this.forecast=l)})}}return(n=o).\u0275fac=function(e){return new(e||n)(t.Y36(a),t.Y36(m.gz))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-forecasts-list"]],decls:9,vars:3,consts:[[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-title"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"btn","btn-success",3,"routerLink"],[1,"list-group-item"],[1,"icon",3,"src"]],template:function(e,r){1&e&&(t.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"h3",2),t._uU(4),t.qZA()(),t.TgZ(5,"ul",3),t.YNc(6,j,6,14,"li",4),t.qZA()()(),t.TgZ(7,"button",5),t._uU(8,"< Back to main page"),t.qZA()),2&e&&(t.xp6(4),t.hij("5-day forecast for ",null==r.forecast?null:r.forecast.city.name,""),t.xp6(2),t.Q6J("ngForOf",null==r.forecast?null:r.forecast.list),t.xp6(1),t.Q6J("routerLink","/"))},dependencies:[u.sg,m.rH,u.JJ,u.uU],styles:[".icon[_ngcontent-%COMP%]{width:45px;height:45px;position:absolute;right:20px;top:-2px}.panel[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{border:none;margin:0 2rem}button[_ngcontent-%COMP%]{margin-top:1rem}.panel-heading[_ngcontent-%COMP%]{font-variant:small-caps;color:var(--main-color-ligth);background-color:var(--color-dark)!important;border-bottom:2px solid black}.list-group-item[_ngcontent-%COMP%]{background-color:var(--color-dark)}"]}),o})()},{path:"**",redirectTo:"/current-conditions"}];let G=(()=>{var n;class o{}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[m.Bz.forChild(Y),m.Bz]}),o})(),q=(()=>{var n;class o{}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[h,a,L],imports:[u.ez,G,S,T]}),o})()}}]);